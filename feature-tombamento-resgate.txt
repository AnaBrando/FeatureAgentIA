# Feature Specification: Tombamento de fundos na nova arquitetura de fundos (resgate)

## Business

Para atingirmos a máxima performance do produto de fundos no carrinho do IFA, devemos migrar para a nova arquitetura.

- O MFE deve consumir diretamente o novo BFF (Backend for Front End), que por sua vez buscará os dados da API de fundos FN8 (departamento de fundos).
- Ao logar no IFA, o especialista poderá operar na conta de um cliente selecionado para efetuar um resgate.
- O especialista deve visualizar:
  - Quais fundos o cliente já possui posição
  - O valor máximo permitido para resgate por fundo
- Devem ser criadas duas rotas:
  - Uma para **busca genérica de fundos** no contexto do cliente
  - Outra para **detalhes de um fundo específico** no contexto do cliente

## Implementation

### Endpoint 1: `/resgate/{resgateId}` – Detalhar fundo para resgate

1. Criar o endpoint `GET /resgate/{resgateId}` no BFF
2. Criar a classe `ListarDetalheProdutosParaResgate` com os campos:
   - `AtivoId`
   - `DocumentoCliente`
   - `AgenciaCliente`
   - `ContaCliente`
   - `DacCliente`
3. Criar o handler `BuscarOfertaParaResgateHandler`
4. O handler deve:
   - Obter os fundos e posições de resgate conforme o cliente
   - Consumir a rota de posição detalhada da FN8

```bash
# Exemplo de requisição GET para FN8
curl -X GET https://api.exemplo.com/dados ^
  -H "Authorization: Bearer SEU_TOKEN_AQUI" ^
  -H "Accept: application/json"
```

---

### Endpoint 2: `/resgates` – Busca genérica de fundos para resgate

1. Criar o endpoint `GET /resgates` no BFF
2. Criar a classe `ListarProdutosParaResgate` com os campos:
   - `DocumentoCliente`
   - `AgenciaCliente`
   - `ContaCliente`
   - `DacCliente`
3. Criar o handler `BuscarOfertasParaResgateHandler`
4. O handler deve:
   - Obter os fundos e posições de resgate do cliente
   - Consumir a rota da FN8 (lista de posições)

```bash
# Exemplo de requisição GET para FN8
curl -X GET https://api.exemplo.com/dados ^
  -H "Authorization: Bearer SEU_TOKEN_AQUI" ^
  -H "Accept: application/json"
```

---

## Quality

1. Criar massa de teste com cliente que possua saldo e fundos aplicados na FN8
2. Testar os endpoints com cliente logado via Insomnia ou Postman
3. Enviar requisições com dados inválidos para validação
4. A aplicação **não deve retornar erros 5xx (500+)** em nenhuma hipótese
   - Todos os erros devem retornar **status 400 com mensagem tratada**
5. Cobertura de testes:
   - Testes unitários dos handlers
   - Testes de integração com simulação da API FN8
   - Cenários BDD definidos
   - DoR (Definition of Ready) concluída